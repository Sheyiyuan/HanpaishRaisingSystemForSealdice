// ==UserScript==
// @name         HanpaishRaisingSystem
// @author       Sheyiyuan
// @version      1.0.1
// @description  一款简单配置的骰子养成系统插件
// @timestamp    1732190433
// @license      MIT
// @homepageURL  https://github.com/Sheyiyuan/HanpaishRaisingSystemForSealdice
// @updateURL    https://github.com/Sheyiyuan/HanpaishRaisingSystemForSealdice/master/dist/HanpaishRaisingSystem.js
// ==/UserScript==

(()=>{function S(e,t,a=1,m=0,s=0){let o=0,l;for(let g=0;g<e;g++){let n=Math.floor(Math.random()*t)+1;o+=n}return o+=m,l=o*a+s,l}function T(){let e=new Date,t=e.getFullYear(),a=e.getMonth()+1,m=e.getDate(),s=e.getDay(),o=e.getHours(),l=e.getMinutes(),g=e.getSeconds();return{year:t,month:a,day:m,weekday:s,hours:o,minutes:l,seconds:g}}function $(e,t){let a=S(1,100,1,0,0);seal.vars.intSet(e,"$mStatusOfHanpaishRaisingSystem",a);let m=T(),s=+`${m.year}${m.month}${m.day}`,o=seal.vars.intGet(e,"$g\u6253\u5361\u65E5\u671F")[0],l=seal.vars.intGet(e,"$g\u6253\u5361\u6B21\u5E8F")[0],g=seal.vars.intGet(e,"$m\u73A9\u5BB6\u4E0A\u6B21\u6253\u5361\u65E5\u671F")[0],n=seal.vars.intGet(e,"$m\u4F59\u989D")[0];if(g===s)return!1;s!==o?l=1:l+=1,seal.vars.intSet(e,"$g\u6253\u5361\u65E5\u671F",s),seal.vars.intSet(e,"$g\u6253\u5361\u6B21\u5E8F",l);let i=seal.ext.getIntConfig(t,"\u6253\u5361\u521D\u59CB\u8D27\u5E01\u503C"),f=seal.ext.getIntConfig(t,"\u6253\u5361\u6B21\u5E8F\u9012\u51CF\u8D27\u5E01\u503C"),u=seal.ext.getIntConfig(t,"\u6253\u5361\u6700\u4F4E\u8D27\u5E01\u503C"),r=i-(l-1)*f;return r<u&&(r=u),n+=r,seal.vars.intSet(e,"$m\u4F59\u989D",n),seal.vars.intSet(e,"$m\u73A9\u5BB6\u4E0A\u6B21\u6253\u5361\u65E5\u671F",s),{checkInOrder:l,TotalReward:r,playerBalance:n}}function d(e,t){let a=seal.ext.getStringConfig(t,"\u5BF9\u73A9\u5BB6\u79F0\u547C\u7684\u524D\u7F00"),m=seal.ext.getStringConfig(t,"\u5BF9\u73A9\u5BB6\u79F0\u547C\u7684\u540E\u7F00"),s=seal.ext.getStringConfig(t,"\u8D27\u5E01\u540D\u79F0/\u5355\u4F4D\uFF08\u4E0D\u53EF\u7559\u7A7A\uFF01\uFF09"),o=seal.ext.getBoolConfig(t,"\u662F\u5426\u79F0\u547C\u73A9\u5BB6\u540D\u5B57"),l=e.player.name;o&&(l=a+l+m);let g=seal.ext.getStringConfig(t,"\u9AB0\u5B50\u540D\u5B57"),n=seal.ext.getStringConfig(t,"\u6253\u5361\u884C\u4E3A\u540D\u79F0");return{playerName:l,selfName:g,currencyName:s,checkInName:n}}function N(e){let t=seal.ext.getTemplateConfig(e,"\u793C\u7269\u767D\u540D\u5355"),a=seal.ext.getTemplateConfig(e,"\u793C\u7269\u9ED1\u540D\u5355"),m=seal.ext.getIntConfig(e,"\u767D\u540D\u5355\u4EF7\u683C"),s=seal.ext.getIntConfig(e,"\u9ED1\u540D\u5355\u4EF7\u683C"),o=seal.ext.getIntConfig(e,"\u666E\u901A\u793C\u7269\u4EF7\u683C"),l=seal.ext.getStringConfig(e,"\u767D\u540D\u5355\u597D\u611F\u5EA6"),g=seal.ext.getStringConfig(e,"\u9ED1\u540D\u5355\u51CF\u5C11\u597D\u611F\u5EA6"),n=seal.ext.getStringConfig(e,"\u666E\u901A\u793C\u7269\u597D\u611F\u5EA6"),i=seal.ext.getTemplateConfig(e,"\u767D\u540D\u5355\u793C\u7269\u56DE\u590D\u8BED\u53E5"),f=seal.ext.getTemplateConfig(e,"\u9ED1\u540D\u5355\u793C\u7269\u56DE\u590D\u8BED\u53E5"),u=seal.ext.getTemplateConfig(e,"\u666E\u901A\u793C\u7269\u56DE\u590D\u8BED\u53E5"),r=seal.ext.getTemplateConfig(e,"\u4F59\u989D\u4E0D\u8DB3\u56DE\u590D\u8BED\u53E5"),y=seal.ext.getIntConfig(e,"\u73A9\u5BB6\u9001\u793C\u51B7\u5374\u65F6\u95F4");return{whiteList:t,blackList:a,whitePrice:m,blackPrice:s,normalPrice:o,whiteFeeling:l,blackFeeling:g,normalFeeling:n,whiteReply:i,blackReply:f,normalReply:u,notEnoughReply:r,cooldownTime:y}}function c(e){if(!/^[\d\s+\-*/]*(\d+d\d+[\d\s+\-*/]*)*$/.test(e))return NaN;let a=/(\d+)d(\d+)/g,m=e,s;for(;(s=a.exec(e))!==null;){let n=parseInt(s[1]),i=parseInt(s[2]),f=S(n,i);m=m.replace(s[0],String(f))}let o=m.match(new RegExp("\\d+|\\+|\\-|\\*|\\/|(?<!\\d)(?=\\d)|(?<=\\d)(?!\\d)","g"));if(!o)return NaN;let l=[];for(let n=0;n<o.length;n++)if(o[n]==="*"){let i=Number(l.pop())*Number(o[n+1]);l.push(i),n++}else if(o[n]==="/"){let i=Number(l.pop())/Number(o[n+1]);l.push(i),n++}else l.push(o[n]);let g=Number(l[0]);for(let n=1;n<l.length;n++)l[n]==="+"?g+=Number(l[n+1]):l[n]==="-"&&(g-=Number(l[n+1]));return g}function b(){let e=seal.ext.find("HanpaishRaisingSystem");e||(e=seal.ext.new("HanpaishRaisingSystem","Sheyiyuan","1.0.0"),seal.ext.register(e),seal.ext.registerStringConfig(e,"\u9AB0\u5B50\u540D\u5B57","\u534A\u62CD","\u9AB0\u5B50\u7684\u540D\u5B57\uFF0C\u5C06\u51B3\u5B9A\u9AB0\u5B50\u5982\u4F55\u79F0\u547C\u81EA\u5DF1"),seal.ext.registerStringConfig(e,"\u5BF9\u73A9\u5BB6\u79F0\u547C\u7684\u524D\u7F00","","\u5BF9\u73A9\u5BB6\u79F0\u547C\u7684\u524D\u7F00\uFF0C\u53EF\u7559\u7A7A"),seal.ext.registerBoolConfig(e,"\u662F\u5426\u79F0\u547C\u73A9\u5BB6\u540D\u5B57",!0),seal.ext.registerStringConfig(e,"\u5BF9\u73A9\u5BB6\u79F0\u547C\u7684\u540E\u7F00","\u8001\u5E08","\u5BF9\u73A9\u5BB6\u79F0\u547C\u7684\u540E\u7F00\uFF0C\u53EF\u7559\u7A7A"),seal.ext.registerStringConfig(e,"\u8D27\u5E01\u540D\u79F0/\u5355\u4F4D\uFF08\u4E0D\u53EF\u7559\u7A7A\uFF01\uFF09","\u4FE1\u7528\u70B9","\u8D27\u5E01\u540D\u79F0/\u5355\u4F4D\uFF0C\u5728\u6570\u636E\u5E93\u4E2D\u4F7F\u7528\u521D\u9636\u8C79\u8BED\u7684${m\u4F59\u989D}\u50A8\u5B58"),seal.ext.registerStringConfig(e,"\u6253\u5361\u884C\u4E3A\u540D\u79F0","\u6253\u5361",`\u9AB0\u5B50\u5C06\u7528\u8FD9\u4E00\u540D\u79F0\u79F0\u547C\u7FA4\u5185\u7684\u6253\u5361\u884C\u4E3A\uFF0C\u5EFA\u8BAE\u8BCD\u5F62\u5982\uFF1A\u7948\u7977\u3001\u6253\u5361\u3001\u7B7E\u5230
\u4E0D\u662F\u6307\u4EE4!\u4E0D\u662F\u6307\u4EE4\uFF01\u4E0D\u662F\u6307\u4EE4\uFF01`),seal.ext.registerIntConfig(e,"\u73A9\u5BB6\u9001\u793C\u51B7\u5374\u65F6\u95F4",0,"\u73A9\u5BB6\u9700\u8981\u7B49\u5F85\u591A\u5C11\u65F6\u95F4\uFF08\u5355\u4F4D\uFF1A\u79D2\uFF09\u624D\u80FD\u518D\u6B21\u9001\u793C\uFF0C\u586B\u51990\u5219\u4E0D\u9650\u5236"),seal.ext.registerTemplateConfig(e,"\u793C\u7269\u767D\u540D\u5355",["\u51B0\u6DC7\u51CC","\u51B0\u6DC7\u6DCB","\u9EA6\u65CB\u98CE","\u5C0F\u56E2\u5B50","\u6CD5\u68CD","fu","\u6700\u7EC8\u7269\u8BED","\u5927\u6210\u529F"]),seal.ext.registerIntConfig(e,"\u767D\u540D\u5355\u4EF7\u683C",3e3,"\u767D\u540D\u5355\u4E2D\u6BCF\u4EF6\u793C\u7269\u7684\u4EF7\u683C"),seal.ext.registerStringConfig(e,"\u767D\u540D\u5355\u597D\u611F\u5EA6","4d2","\u767D\u540D\u5355\u4E2D\u6BCF\u4EF6\u793C\u7269\u7684\u597D\u611F\u5EA6\uFF0C\u53EF\u7528\u63B7\u9AB0\u8868\u8FBE\u5F0F"),seal.ext.registerTemplateConfig(e,"\u793C\u7269\u9ED1\u540D\u5355",["\u9999\u83DC","\u5207\u7247\u8089\u7CBD","\u4F5C\u4E1A","\u5927\u5931\u8D25","bug","\u65E9\u516B","\u9AD8\u7B49\u4EE3\u6570"]),seal.ext.registerIntConfig(e,"\u9ED1\u540D\u5355\u4EF7\u683C",5e3,"\u9ED1\u540D\u5355\u4E2D\u6BCF\u4EF6\u793C\u7269\u7684\u4EF7\u683C"),seal.ext.registerStringConfig(e,"\u9ED1\u540D\u5355\u51CF\u5C11\u597D\u611F\u5EA6","1d4","\u9ED1\u540D\u5355\u4E2D\u6BCF\u4EF6\u793C\u7269\u7684\u597D\u611F\u5EA6\u51CF\u5C11\u91CF\uFF0C\u53EF\u7528\u63B7\u9AB0\u8868\u8FBE\u5F0F"),seal.ext.registerIntConfig(e,"\u666E\u901A\u793C\u7269\u4EF7\u683C",2e3),seal.ext.registerStringConfig(e,"\u666E\u901A\u793C\u7269\u597D\u611F\u5EA6","2d2","\u666E\u901A\u793C\u7269\u7684\u597D\u611F\u5EA6\uFF0C\u53EF\u7528\u63B7\u9AB0\u8868\u8FBE\u5F0F"),seal.ext.registerIntConfig(e,"\u6253\u5361\u521D\u59CB\u8D27\u5E01\u503C",7500,"\u7FA4\u5185\u521D\u59CB\u6BCF\u65E5\u6253\u5361\u83B7\u5F97\u7684\u8D27\u5E01\u6570\u91CF"),seal.ext.registerIntConfig(e,"\u6253\u5361\u6B21\u5E8F\u9012\u51CF\u8D27\u5E01\u503C",500,"\u7FA4\u5185\u6309\u7167\u6BCF\u65E5\u6253\u5361\u6B21\u5E8F\u9012\u51CF\u7684\u8D27\u5E01\u83B7\u53D6\u91CF\uFF0C\u5373\u6BCF\u65E5\u6253\u5361\u4EBA\u6BD4\u524D\u4E00\u540D\u5C11\u5F97\u5230\u7684\u8D27\u5E01\u6570\u91CF\uFF0C\u586B\u51990\u5219\u4E0D\u9012\u51CF"),seal.ext.registerIntConfig(e,"\u6253\u5361\u6700\u4F4E\u8D27\u5E01\u503C",5e3,"\u7FA4\u5185\u6BCF\u65E5\u6253\u5361\u6700\u4F4E\u83B7\u5F97\u7684\u8D27\u5E01\u6570\u91CF"),seal.ext.registerTemplateConfig(e,"\u767D\u540D\u5355\u793C\u7269\u56DE\u590D\u8BED\u53E5",['\u534A\u62CD\u770B\u4E0A\u53BB\u5F88\u5F00\u5FC3\uFF0C"\u8C22\u8C22\u8001\u5E08"'],"\u767D\u540D\u5355\u793C\u7269\u88AB\u9001\u51FA\u65F6\u56DE\u590D\u7684\u8BED\u53E5\uFF0C\u4F1A\u4ECE\u586B\u5199\u7684\u8BED\u53E5\u4E2D\u968F\u673A\u9009\u62E9\u4E00\u6761"),seal.ext.registerTemplateConfig(e,"\u9ED1\u540D\u5355\u793C\u7269\u56DE\u590D\u8BED\u53E5",['"\u8BF6\uFF1F\u8C22...\u8C22\u8C22......"\uFF0C\u534A\u62CD\u7684\u8138\u4E0A\u6CA1\u6709\u8868\u60C5\u3002'],"\u9ED1\u540D\u5355\u793C\u7269\u88AB\u9001\u51FA\u65F6\u56DE\u590D\u7684\u8BED\u53E5\uFF0C\u4F1A\u4ECE\u586B\u5199\u7684\u8BED\u53E5\u4E2D\u968F\u673A\u9009\u62E9\u4E00\u6761"),seal.ext.registerTemplateConfig(e,"\u666E\u901A\u793C\u7269\u56DE\u590D\u8BED\u53E5",['"\u5514......\u8C22\u8C22\u8001\u5E08\u7684\u793C\u7269\u4E86\u3002"'],"\u666E\u901A\u793C\u7269\u88AB\u9001\u51FA\u65F6\u56DE\u590D\u7684\u8BED\u53E5\uFF0C\u4F1A\u4ECE\u586B\u5199\u7684\u8BED\u53E5\u4E2D\u968F\u673A\u9009\u62E9\u4E00\u6761"),seal.ext.registerTemplateConfig(e,"\u4F59\u989D\u4E0D\u8DB3\u56DE\u590D\u8BED\u53E5",["\u4F60\u7FFB\u4E86\u7FFB\u53E3\u888B\uFF0C\u81EA\u5DF1\u7684\u4F59\u989D\u4F3C\u4E4E\u4E0D\u592A\u652F\u6301\u4F60\u7684\u60F3\u6CD5"],"\u73A9\u5BB6\u4F59\u989D\u4E0D\u8DB3\u65F6\u56DE\u590D\u7684\u8BED\u53E5\uFF0C\u4F1A\u4ECE\u586B\u5199\u7684\u8BED\u53E5\u4E2D\u968F\u673A\u9009\u62E9\u4E00\u6761"),seal.ext.registerStringConfig(e,"\u6253\u5361\u6307\u4EE4","\u6253\u5361","\u7FA4\u5185\u6307\u4EE4\uFF0C\u73A9\u5BB6\u8F93\u5165\u8BE5\u6307\u4EE4\u540E\u53EF\u4EE5\u8FDB\u884C\u4E00\u6B21\u6253\u5361(\u76F8\u5F53\u4E8E\u81EA\u5B9A\u4E49\u56DE\u590D\uFF0C\u65E0\u9700\u4F7F\u7528'\u3002'\u7B49\u63D0\u793A\u7B26\uFF0C\u4E0B\u540C)"),seal.ext.registerStringConfig(e,"\u4F59\u989D\u67E5\u8BE2\u6307\u4EE4","\u67E5\u8BE2\u4F59\u989D","\u7FA4\u5185\u6307\u4EE4\uFF0C\u73A9\u5BB6\u8F93\u5165\u8BE5\u6307\u4EE4\u540E\u53EF\u4EE5\u67E5\u8BE2\u81EA\u5DF1\u7684\u4F59\u989D"),seal.ext.registerTemplateConfig(e,"\u8D60\u9001\u6307\u4EE4",["\u8D60\u9001","\u7ED9\u534A\u62CD"],"\u7FA4\u5185\u6307\u4EE4\uFF0C\u73A9\u5BB6\u8F93\u5165\u201C\u6307\u4EE4+\u793C\u7269\u540D\u79F0\u201D\u540E\u53EF\u4EE5\u8D60\u9001\u793C\u7269\uFF0C\u5982\uFF1A\u7ED9\u534A\u62CD\u6CD5\u68CD"),seal.ext.registerStringConfig(e,"\u597D\u611F\u5EA6\u67E5\u8BE2\u6307\u4EE4","\u67E5\u8BE2\u597D\u611F\u5EA6","\u7FA4\u5185\u6307\u4EE4\uFF0C\u73A9\u5BB6\u8F93\u5165\u8BE5\u6307\u4EE4\u540E\u53EF\u4EE5\u67E5\u8BE2\u81EA\u5DF1\u7684\u597D\u611F\u5EA6")),e.onNotCommandReceived=(t,a)=>{let m=seal.ext.getStringConfig(e,"\u6253\u5361\u6307\u4EE4"),s=seal.ext.getTemplateConfig(e,"\u8D60\u9001\u6307\u4EE4"),o=seal.ext.getStringConfig(e,"\u4F59\u989D\u67E5\u8BE2\u6307\u4EE4"),l=seal.ext.getStringConfig(e,"\u597D\u611F\u5EA6\u67E5\u8BE2\u6307\u4EE4"),g=a.message;if(g===m){let n=$(t,e),i=d(t,e),f;if(!n){f=`${i.playerName}\u4ECA\u5929\u5DF2\u7ECF\u6253\u8FC7\u5361\u4E86\uFF0C\u8BF7\u660E\u5929\u518D\u6765\u5427\uFF01`,seal.replyToSender(t,a,f);return}f=`${i.playerName}\u5728\u4ECA\u5929\u7FA4\u5185\u7B2C${n.checkInOrder}\u4E2A${i.checkInName}\uFF0C\u83B7\u5F97\u4E86${n.TotalReward}\u4E2A${i.currencyName}\u3002\u5F53\u524D\u4F59\u989D\u4E3A${n.playerBalance}\u3002`,seal.replyToSender(t,a,f)}if(g===o){let n=seal.vars.intGet(t,"$m\u4F59\u989D")[0],i=d(t,e),f=`${i.playerName}\u5F53\u524D\u62E5\u6709${n}${i.currencyName}\u3002`;seal.replyToSender(t,a,f)}if(g===l){let n=seal.vars.intGet(t,"$m\u597D\u611F\u5EA6")[0],i=d(t,e),f=`${i.selfName}\u5BF9${i.playerName}\u7684\u597D\u611F\u5EA6\u4E3A${n}\u3002`;seal.replyToSender(t,a,f)}for(let n=0;n<s.length;n++)if(g.startsWith(s[n])){let i=g.substring(s[n].length),f=d(t,e),u=seal.vars.intGet(t,"$m\u4F59\u989D")[0],r=N(e),y=seal.vars.intGet(t,"$m\u597D\u611F\u5EA6")[0];if(i==="")return;if(r.whiteList.includes(i)){if(u<r.whitePrice){let C=r.notEnoughReply[Math.floor(Math.random()*r.notEnoughReply.length)];seal.replyToSender(t,a,C);return}u-=r.whitePrice;let p=c(seal.ext.getStringConfig(e,"\u767D\u540D\u5355\u597D\u611F\u5EA6"));if(isNaN(p)){seal.replyToSender(t,a,"Error:\u2018\u767D\u540D\u5355\u597D\u611F\u5EA6\u2019\u914D\u7F6E\u9879\u6709\u8BEF\uFF0C\u8BF7\u8054\u7CFB\u9AB0\u4E3B\u68C0\u67E5\u914D\u7F6E\uFF01\uFF0C\u8BF7\u8054\u7CFB\u9AB0\u4E3B\u68C0\u67E5\u914D\u7F6E\uFF01");return}y+=p,seal.vars.intSet(t,"$m\u597D\u611F\u5EA6",y);let h=r.whiteReply[Math.floor(Math.random()*r.whiteReply.length)];h+=`
${f.selfName}\u5BF9${f.playerName}\u7684\u597D\u611F\u5EA6\u589E\u52A0\u4E86${p}\u3002`,seal.replyToSender(t,a,h),seal.vars.intSet(t,"$m\u4F59\u989D",u)}else if(r.blackList.includes(i)){if(u<r.blackPrice){let C=r.notEnoughReply[Math.floor(Math.random()*r.notEnoughReply.length)];seal.replyToSender(t,a,C);return}u-=r.blackPrice;let p=c(seal.ext.getStringConfig(e,"\u9ED1\u540D\u5355\u51CF\u5C11\u597D\u611F\u5EA6"));if(isNaN(p)){seal.replyToSender(t,a,"Error:\u2018\u9ED1\u540D\u5355\u51CF\u5C11\u597D\u611F\u5EA6\u2019\u914D\u7F6E\u9879\u6709\u8BEF\uFF0C\u8BF7\u8054\u7CFB\u9AB0\u4E3B\u68C0\u67E5\u914D\u7F6E\uFF01");return}y-=p,seal.vars.intSet(t,"$m\u597D\u611F\u5EA6",y);let h=r.blackReply[Math.floor(Math.random()*r.blackReply.length)];seal.replyToSender(t,a,h),seal.vars.intSet(t,"$m\u4F59\u989D",u)}else{if(u<r.normalPrice){let C=r.notEnoughReply[Math.floor(Math.random()*r.notEnoughReply.length)];seal.replyToSender(t,a,C);return}u-=r.normalPrice;let p=c(seal.ext.getStringConfig(e,"\u666E\u901A\u793C\u7269\u597D\u611F\u5EA6"));if(isNaN(p)){seal.replyToSender(t,a,"Error:\u2018\u666E\u901A\u793C\u7269\u597D\u611F\u5EA6\u2019\u914D\u7F6E\u9879\u6709\u8BEF\uFF0C\u8BF7\u8054\u7CFB\u9AB0\u4E3B\u68C0\u67E5\u914D\u7F6E\uFF01");return}y+=p,seal.vars.intSet(t,"$m\u597D\u611F\u5EA6",y);let h=r.normalReply[Math.floor(Math.random()*r.normalReply.length)];h+=`
${f.selfName}\u5BF9${f.playerName}\u7684\u597D\u611F\u5EA6\u589E\u52A0\u4E86${p}\u3002`,seal.replyToSender(t,a,h),seal.vars.intSet(t,"$m\u4F59\u989D",u)}}}}b();})();
